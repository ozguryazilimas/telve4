<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="/layout/dialogBase.xhtml">

    <ui:param name="title" value="File Uploader" />
    <ui:define name="form">
        <h:form id="fileUpload">
            <p:remoteCommand name="sendFileUploadEvent" action="#{fileUploadDialog.fileUploaded}" />
                        
            <div class="row">
            
                <div class="DashboardContainer"></div>
                
                <h:outputScript library="webjars" name="/telve-uppy/0.28.0/uppy-bundle.js" />
                <script>

                    var turkishLocale = {
                        strings: {
                            //core
                            youCanOnlyUploadX: {
                                0: 'Sadece %{smart_count} adet dosya yükleyebilirsiniz',
                                1: 'Sadece %{smart_count} adet dosya yükleyebilirsiniz'
                            },
                            youHaveToAtLeastSelectX: {
                                0: 'En az %{smart_count} adet dosya seçmeniz gereklidir',
                                1: 'En az %{smart_count} adet dosya seçmeniz gereklidir'
                            },
                            exceedsSize: 'Maksimum dosya boyutu:',
                            youCanOnlyUploadFileTypes: 'İzin verilen dosya tipleri:',
                            companionError: 'Bağlantı hatası',
                            failedToUpload: '%{file} dosyası için yükleme başarısız oldu',
                            noInternetConnection: 'İnternet bağlantısı yok',
                            connectedToInternet: 'İnternete bağlanıldı',
                            // Strings for remote providers
                            noFilesFound: 'Burada bir dosya veya klasör yok',
                            selectXFiles: {
                                0: '%{smart_count} adet dosya seç',
                                1: '%{smart_count} adet dosya seç'
                            },
                            cancel: 'İptal et',
                            logOut: 'Çıkış yap',
                            //dashboard
                            selectToUpload: 'Yüklenecek dosyaları seçin',
                            closeModal: 'Açılır pencereyi kapat',
                            upload: 'Yükle',
                            importFrom: 'Şuradan içe aktar: %{name}',
                            addingMoreFiles: 'Dosyalar ekleniyor',
                            addMoreFiles: 'Fazladan dosya ekle',
                            dashboardWindowTitle: 'Uppy Kontrol Paneli Penceresi (Kapatmak için \'escape\' tuşuna basın)',
                            dashboardTitle: 'Uppy Kontrol Paneli',
                            copyLinkToClipboardSuccess: 'Bağlantı panoya kopyalandı',
                            copyLinkToClipboardFallback: 'Aşağıdaki bağlantıyı kopyalayın',
                            copyLink: 'Bağlantıyı kopyala',
                            fileSource: 'Dosya kaynağı: %{name}',
                            done: 'Tamamlandı',
                            back: 'Geri',
                            name: 'İsim',
                            removeFile: 'Dosyayı kaldır',
                            editFile: 'Dosyayı düzenle',
                            editing: 'Düzenleniyor: %{file}',
                            edit: 'Düzenle',
                            finishEditingFile: 'Dosyayı düzenlemeyi bitir',
                            saveChanges: 'Değişiklikleri kaydet',
                            localDisk: 'Yerel Disk',
                            myDevice: 'Benim Cihazım',
                            dropPasteImport: 'Dosyaları buraya sürükleyip bırak, yapıştır, %{browse} veya içe aktar',
                            dropPaste: 'Dosyaları buraya sürükleyip bırak, yapıştır veya %{browse}',
                            browse: 'göz at',
                            fileProgress: 'Dosya ilerleme durumu: yükleme hızı ve tahmini bitiş süresi',
                            numberOfSelectedFiles: 'Seçilen dosya sayısı',
                            uploadAllNewFiles: 'Yeni dosyaların tümünü yükle',
                            emptyFolderAdded: 'Boş klasörden hiçbir dosya eklenmedi',
                            uploadComplete: 'Yükleme tamamlandı',
                            uploadPaused: 'Yükleme duraklatıldı',
                            resumeUpload: 'Yüklemeyi devam ettir',
                            pauseUpload: 'Yüklemeyi duraklat',
                            retryUpload: 'Tekrar yüklemeyi dene',
                            cancelUpload: 'Yüklemeyi iptal et',
                            xFilesSelected: {
                                0: '%{smart_count} adet dosya seçildi',
                                1: '%{smart_count} adet dosya seçildi'
                            },
                            uploadXFiles: {
                                0: '%{smart_count} adet dosya yükle',
                                1: '%{smart_count} adet dosya yükle'
                            },
                            uploadingXFiles: {
                                0: '%{smart_count} adet dosya yükleniyor',
                                1: '%{smart_count} adet dosya yükleniyor'
                            },
                            processingXFiles: {
                                0: '%{smart_count} adet dosya işleniyor',
                                1: '%{smart_count} adet dosya işleniyor'
                            },
                            uploadXNewFiles: {
                                0: '+%{smart_count} adet dosya yükle',
                                1: '+%{smart_count} adet dosya yükle'
                            },
                            folderAdded: {
                                0: '%{folder} klasöründen %{smart_count} dosya eklendi',
                                1: '%{folder} klasöründen %{smart_count} dosya eklendi'
                            },
                            //statusbar
                            uploading: 'Yükleniyor',
                            complete: 'Tamamlandı',
                            uploadFailed: 'Yükleme başarısız oldu',
                            pleasePressRetry: 'Tekrar yüklemek için lütfen \'Yeniden dene\' tuşuna basınız',
                            paused: 'Duraklatıldı',
                            error: 'Hata',
                            retry: 'Yeniden dene',
                            pause: 'Duraklat',
                            resume: 'Devam et',
                            pressToRetry: 'Tekrar denemek için buraya basınız',
                            filesUploadedOfTotal: {
                                0: '%{smart_count} adet dosyadan %{complete} tanesi yüklendi',
                                1: '%{smart_count} adet dosyadan %{complete} tanesi yüklendi'
                            },
                            dataUploadedOfTotal: '%{complete}/%{total}',
                            xTimeLeft: 'Kalan süre: %{time}',
                            xMoreFilesAdded: {
                                0: '%{smart_count} adet dosya eklendi',
                                1: '%{smart_count} adet dosya eklendi'
                            }
                        }
                    };

        var uppy = Uppy.Core({
            allowMultipleUploads: true,
            debug: false,
            autoProceed: true,
            locale: turkishLocale,
            restrictions: {
                maxFileSize: #{fileUploadDialog.maxFileSize != null ? fileUploadDialog.maxFileSize : 'null'},
                maxNumberOfFiles: #{fileUploadDialog.maxNumberOfFiles != null ? fileUploadDialog.maxNumberOfFiles : 'null'},
                allowedFileTypes: #{fileUploadDialog.allowedFileTypes != null ? fileUploadDialog.allowedFileTypes : 'null'}
            }
        })
        
        .use(Uppy.Dashboard, {
          inline: true,
          target: '.DashboardContainer',
          replaceTargetContent: true,
          height: 250
        })/*
        .use(Uppy.FileInput, {target: '.DashboardContainer', replaceTargetContent: true})
        .use(Uppy.ProgressBar, {
            target: 'body',
            fixed: true,
            hideAfterFinish: false
        })*/
        .use(Uppy.Tus, {endpoint: '#{fileUploadDialog.endPoint}', chunkSize: #{fileUploadDialog.chunkSize}});

      uppy.on('complete', (result) => {
        console.log(`Upload complete! We’ve uploaded these files: ${result.successful}`)
      });
      
      uppy.on('upload-success', function(file, upload) {
        console.log("Upload " + file.name + " completed with URL " + upload.url);
        console.log("Developer: Now pass URL " + upload.url + " to the backend or dynmically add it to an existing form!");
        sendFileUploadEvent([{'name': 'uri', 'value': upload.url}]);
       });
    
                </script>
            </div>

            

            <h:panelGroup styleClass="row actionButtons" layout="block" >
                <ui:insert name="actionButtons" />
                <p:commandButton id="select" 
                                 value="#{messages['general.button.Ok']}" 
                                 icon="fa fa-check" 
                                 disabled="#{facesContext.validationFailed}"
                                 validateClient="true"
                                 action="#{fileUploadDialog.closeDialog()}" 
                                 styleClass="btn-primary" />
                <p:commandButton id="close" 
                                 value="#{messages['general.button.Cancel']}" 
                                 icon="ui-icon-close" 
                                 action="#{fileUploadDialog.closeDialog()}" 
                                 partialSubmit="true" 
                                 process="@this"/>
            </h:panelGroup>
        </h:form>
    </ui:define> 
</ui:composition>
